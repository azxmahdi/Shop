from django.core.management.base import BaseCommand
from faker import Faker
from random import choice, randint, uniform
from django.contrib.auth import get_user_model
from django.db import transaction
from django.utils.text import slugify
from shop.models import (
    ProductCategoryModel,
    CategoryFeature,
    FeatureOption,
    ProductModel,
    ProductFeature
)

fake = Faker('fa_IR')
User = get_user_model()

class Command(BaseCommand):
    help = 'ایجاد داده‌های نمونه با ۱۴ ویژگی برای هر دسته (۷ اجباری + ۷ غیراجباری)'

    @transaction.atomic
    def handle(self, *args, **kwargs):
        self.create_all_features()
        self.create_feature_options()
        self.stdout.write(self.style.SUCCESS('Default features for all categories were successfully created.'))

    def create_all_features(self):
        feature_templates = {
            'digital-devices': {
                'required': [
                    'گارانتی', 'کشور سازنده', 'نوع باتری', 'رزولوشن دوربین',
                    'سیستم عامل', 'پشتیبانی شبکه', 'مقاومت در برابر آب'
                ],
                'optional': [
                    'وزن دستگاه', 'ابعاد جعبه', 'رنگبندی UI', 'تعداد سیمکارت',
                    'دمای عملیاتی', 'سطح صدای ماکسیمم', 'نوع درگاه شارژ'
                ]
            },
            'fashion-clothing': {
                'required': [
                    'جنس پارچه', 'فصل مناسب', 'سایزبندی', 'نوع دوخت',
                    'قابلیت شستشو', 'مناسب قد', 'ضد حساسیت'
                ],
                'optional': [
                    'طرح پارچه', 'تعداد جیب', 'نوع دکمه', 'قد لباس',
                    'رنگبندی داخلی', 'قابلیت اتوکشی', 'مناسب فصل خاص'
                ]
            },
            'home-kitchen': {
                'required': [
                    'متریال', 'استانداردهای ایمنی', 'رنگ', 'ابعاد',
                    'نوع برق', 'توان مصرفی', 'گواهی کیفیت'
                ],
                'optional': [
                    'وزن محصول', 'تعداد قطعات', 'رنگ داخلی', 'مناسب مایکروویو',
                    'قابلیت نصب دیواری', 'ضد لک', 'ضد خش'
                ]
            },
            'sports-fitness': {
                'required': [
                    'جنس', 'وزن', 'مناسب ورزش', 'سایز',
                    'ضد لغزش', 'ضد عرق', 'گارانتی'
                ],
                'optional': [
                    'رنگ', 'تعداد تنظیمات', 'مناسب قد', 'دمای کارکرد',
                    'نوع بسته‌بندی', 'قابلیت حمل', 'مناسب فضای باز'
                ]
            },
            'health-beauty': {
                'required': [
                    'نوع پوست', 'مناسب سن', 'ترکیبات', 'حجم',
                    'تاریخ انقضا', 'کشور سازنده', 'ضد حساسیت'
                ],
                'optional': [
                    'رایحه', 'رنگ', 'وزن', 'مناسب فصل',
                    'نوع بسته‌بندی', 'قابلیت حمل', 'مناسب سفر'
                ]
            },
            'baby-child': {
                'required': [
                    'گروه سنی', 'جنس مواد', 'ضد حساسیت', 'قابلیت شستشو',
                    'ابعاد', 'وزن', 'استاندارد ایمنی'
                ],
                'optional': [
                    'رنگ', 'طرح', 'تعداد قطعات', 'مناسب ماشین لباسشویی',
                    'نوع بسته‌بندی', 'قابلیت تنظیم', 'مناسب مسافرت'
                ]
            },
            'books-entertainment': {
                'required': [
                    'زبان', 'نویسنده', 'ناشر', 'تعداد صفحات',
                    'سال انتشار', 'ژانر', 'قطع کتاب'
                ],
                'optional': [
                    'رنگ جلد', 'وزن', 'نوع کاغذ', 'مناسب سن',
                    'قابلیت حمل', 'نوع صحافی', 'ضد آب'
                ]
            },
            'garden-yard': {
                'required': [
                    'نوع مصرف', 'مقاومت در برابر', 'ابعاد', 'وزن',
                    'جنس', 'رنگ', 'گارانتی'
                ],
                'optional': [
                    'مناسب فصل', 'قابلیت تنظیم ارتفاع', 'تعداد قطعات',
                    'نوع بسته‌بندی', 'ضد زنگ', 'مناسب فضای داخلی', 'مناسب فضای باز'
                ]
            },

            'mobile-phones': {
                'required': [
                    'حافظه داخلی', 'رنگ', 'نوع صفحه نمایش', 'ظرفیت باتری',
                    'تعداد دوربین', 'نسخه بلوتوث', 'نوع اسلات حافظه'
                ],
                'optional': [
                    'ضخامت دستگاه', 'نوع قاب محافظ', 'سطح روشنایی صفحه',
                    'نوع رابط کاربری', 'مناسب دست چپ/راست', 'قابلیت پشتیبانی 5G', 'دمای کارکرد'
                ]
            },
            'electronics-accessories': {
                'required': [
                    'سازگاری', 'طول کابل', 'جنس', 'ولتاژ ورودی',
                    'رنگ', 'گارانتی', 'نوع اتصال'
                ],
                'optional': [
                    'وزن', 'مناسب مسافرت', 'ضد آب', 'نوع بسته‌بندی',
                    'قابلیت تا شدن', 'تعداد پورت', 'مناسب دستگاه‌های خاص'
                ]
            },
            'laptops-computers': {
                'required': [
                    'پردازنده', 'حافظه RAM', 'ظرفیت هارد', 'رزولوشن صفحه',
                    'سیستم عامل', 'وزن', 'ابعاد'
                ],
                'optional': [
                    'نوع کیبورد', 'تعداد پورت USB', 'قابلیت ارتقا', 'مناسب بازی',
                    'ضد خش', 'نوع خنک‌کننده', 'مناسب طراحی'
                ]
            },
            'home-theater-tv': {
                'required': [
                    'اندازه صفحه', 'رزولوشن', 'نوع پنل', 'فرکانس تصویر',
                    'تعداد پورت HDMI', 'توان مصرفی', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'ضخامت حاشیه', 'قابلیت نصب دیواری', 'منابع صوتی',
                    'رنگ پایه', 'نوع پایه', 'مناسب فضای کوچک'
                ]
            },
            'gaming-consoles': {
                'required': [
                    'برند', 'ظرفیت حافظه', 'نوع اتصال', 'رزولوشن خروجی',
                    'تعداد دسته', 'منابع بازی', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'مصرف برق', 'قابلیت حمل', 'نوع خنک‌کننده',
                    'رنگ بدنه', 'مناسب VR', 'تعداد پورت'
                ]
            },

            'womens-clothing': {
                'required': [
                    'سایز', 'سبک', 'قد لباس', 'نوع آستین',
                    'جنس زیرپوش', 'مناسب مجالس', 'طرح کلی'
                ],
                'optional': [
                    'تزیینات', 'نوع زیپ', 'رنگ داخلی', 'قابلیت تنظیم کمر',
                    'مناسب فصل', 'ضد چروک', 'نوع یقه'
                ]
            },
            'mens-clothing': {
                'required': [
                    'سایز', 'نوع پارچه', 'قد لباس', 'نوع یقه',
                    'قابلیت شستشو', 'ضد لک', 'مناسب موقعیت'
                ],
                'optional': [
                    'تعداد جیب', 'نوع دکمه', 'رنگ داخلی', 'مناسب قد بلند',
                    'ضد باد', 'نوع آستر', 'طرح'
                ]
            },
            'shoes': {
                'required': [
                    'سایز کفش', 'نوع کفش', 'جنس رویه', 'جنس کف',
                    'رنگ', 'مناسب فصل', 'ضد آب'
                ],
                'optional': [
                    'وزن', 'ارتفاع پاشنه', 'نوع بند', 'قابلیت تنفس',
                    'ضد بو', 'مناسب پیاده‌روی', 'نوع پد'
                ]
            },
            'fashion-accessories': {
                'required': [
                    'جنس', 'رنگ', 'سایز', 'نوع اتصال',
                    'ضد حساسیت', 'قابلیت تنظیم', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'مناسب موقعیت', 'ضد خش', 'نوع بسته‌بندی',
                    'قابلیت تا شدن', 'مناسب سفر', 'طرح'
                ]
            },
            'bags-luggage': {
                'required': [
                    'نوع کیف', 'جنس', 'ابعاد', 'تعداد چرخ',
                    'ضد آب', 'قابلیت قفل', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'تعداد جیب', 'مناسب پرواز', 'رنگ داخلی',
                    'قابلیت تنظیم بند', 'ضد خراش', 'نوع دسته'
                ]
            },

            'decorative-items': {
                'required': [
                    'جنس', 'سبک', 'ابعاد', 'رنگ',
                    'ضد UV', 'قابلیت شستشو', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'نوع پایه', 'مناسب دیوار', 'ضد حرارت',
                    'قابلیت نصب', 'مناسب فضای باز', 'نوع نور'
                ]
            },
            'kitchen-appliances': {
                'required': [
                    'نوع دستگاه', 'توان مصرفی', 'رنگ', 'ابعاد',
                    'ولتاژ', 'گواهی ایمنی', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'تعداد سرعت', 'مناسب ماشین ظرفشویی', 'ضد زنگ',
                    'قابلیت برنامه‌ریزی', 'نوع کنترل', 'منابع صوتی'
                ]
            },
            'furniture-decoration': {
                'required': [
                    'جنس', 'سبک', 'ابعاد', 'رنگ',
                    'ضد خش', 'قابلیت مونتاژ', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'تعداد کشو', 'مناسب فضای کوچک', 'ضد آب',
                    'نوع پایه', 'قابلیت تنظیم ارتفاع', 'طرح'
                ]
            },
            'cleaning-equipment': {
                'required': [
                    'نوع', 'توان مصرفی', 'ولتاژ', 'ابعاد',
                    'ضد آلرژی', 'قابلیت شارژ', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'تعداد لوازم جانبی', 'مناسب حیوانات', 'ضد بو',
                    'نوع فیلتر', 'قابلیت تنظیم قدرت', 'رنگ'
                ]
            },
            'lighting': {
                'required': [
                    'نوع لامپ', 'مصرف انرژی', 'رنگ نور', 'ولتاژ',
                    'طول عمر', 'قابلیت تنظیم', 'گارانتی'
                ],
                'optional': [
                    'وزن', 'مناسب فضای باز', 'ضد آب', 'نوع پایه',
                    'قابلیت اتصال به موبایل', 'رنگ بدنه', 'طرح'
                ]
            },

            'sports-equipment': {
                'required': [
                    'نوع ورزش', 'جنس', 'وزن', 'سایز',
                    'ضد لغزش', 'گارانتی', 'استاندارد ایمنی'
                ],
                'optional': [
                    'رنگ', 'تعداد قطعات', 'مناسب قد', 'دمای کارکرد',
                    'نوع بسته‌بندی', 'قابلیت حمل', 'مناسب فضای باز'
                ]
            },
            'sportswear': {
                'required': [
                    'جنس پارچه', 'مناسب فعالیت', 'سایز', 'ضد عرق',
                    'قابلیت شستشو', 'ضد بو', 'گارانتی'
                ],
                'optional': [
                    'رنگ', 'طرح', 'تعداد جیب', 'مناسب فصل',
                    'نوع دوخت', 'قابلیت تنظیم', 'مناسب مسافرت'
                ]
            },
            'sports-supplements': {
                'required': [
                    'نوع مکمل', 'دوز', 'ترکیبات', 'حجم',
                    'تاریخ انقضا', 'کشور سازنده', 'ضد حساسیت'
                ],
                'optional': [
                    'رایحه', 'رنگ', 'وزن', 'مناسب سن',
                    'نوع بسته‌بندی', 'قابلیت حمل', 'مناسب سفر'
                ]
            },
            'bodybuilding-equipment': {
                'required': [
                    'نوع تجهیزات', 'وزن', 'ابعاد', 'جنس',
                    'ضد لغزش', 'گارانتی', 'استاندارد ایمنی'
                ],
                'optional': [
                    'رنگ', 'تعداد تنظیمات', 'مناسب قد', 'دمای کارکرد',
                    'نوع بسته‌بندی', 'قابلیت حمل', 'مناسب فضای باز'
                ]
            },
            'outdoor-sports': {
                'required': [
                    'نوع فعالیت', 'جنس', 'وزن', 'سایز',
                    'ضد آب', 'گارانتی', 'استاندارد ایمنی'
                ],
                'optional': [
                    'رنگ', 'تعداد قطعات', 'مناسب فصل', 'دمای کارکرد',
                    'نوع بسته‌بندی', 'قابلیت حمل', 'مناسب مسافرت'
                ]
            }
        }

        for category in ProductCategoryModel.objects.all():
            data = feature_templates.get(category.slug, {})
            if not data:
                continue

            for name in data.get('required', []):
                CategoryFeature.objects.get_or_create(
                    category=category,
                    name=name,
                    defaults={'is_required': True}
                )

            for name in data.get('optional', []):
                CategoryFeature.objects.get_or_create(
                    category=category,
                    name=name,
                    defaults={'is_required': False}
                )

    def create_feature_options(self):
        option_templates = {
            'گارانتی': ['۱۲ ماهه', '۲۴ ماهه', '۳۶ ماهه'],
            'کشور سازنده': ['ایران', 'چین', 'کره جنوبی', 'آمریکا'],
            'نوع باتری': ['لیتیومی', 'پلیمری', 'نیکل-کادمیوم'],
            'رزولوشن دوربین': ['12MP', '48MP', '108MP'],
            'سیستم عامل': ['Android', 'iOS', 'Windows', 'HarmonyOS'],
            'پشتیبانی شبکه': ['4G', '5G', 'Wi-Fi 6', 'Bluetooth 5.2'],
            'مقاومت در برابر آب': ['IP67', 'IP68', 'بدون مقاومت'],
            'حافظه داخلی': ['64GB', '128GB', '256GB', '512GB'],
            'رنگ': ['مشکی', 'سفید', 'نقرهای', 'آبی', 'قرمز'],
            'نوع صفحه نمایش': ['LCD', 'OLED', 'AMOLED', 'Retina'],
            'سایزبندی': ['XS', 'S', 'M', 'L', 'XL'],
            'جنس پارچه': ['پنبه', 'پلی استر', 'ابریشم', 'کتان'],
            'متریال': ['سرامیک', 'شیشه', 'فلز', 'چوب'],
            'استانداردهای ایمنی': ['CE', 'ISO 9001', 'UL', 'FCC'],
            'نوع برق': ['باتری', 'کابلی', 'شارژی'],
            'توان مصرفی': ['500 وات', '1000 وات', '1500 وات'],
            'مناسب ورزش': ['فوتبال', 'بسکتبال', 'تنیس', 'شنا'],
            'ضد لغزش': ['بله', 'خیر'],
            'ضد عرق': ['بله', 'خیر'],
            'نوع پوست': ['چرب', 'خشک', 'مختلط', 'حساس'],
            'ترکیبات': ['گیاهی', 'شیمیایی', 'ارگانیک'],
            'ژانر': ['رمان', 'تاریخی', 'علمی-تخیلی', 'روانشناسی'],
            'قطع کتاب': ['رقعی', 'وزیری', 'خشتی', 'جیبی'],
            'نوع مصرف': ['خانگی', 'صنعتی', 'تجاری'],
            'مقاومت در برابر': ['باران', 'برف', 'گرما', 'سرما'],
            'وزن دستگاه': lambda: f"{uniform(0.1, 2.0):.1f} کیلوگرم",
            'ابعاد جعبه': lambda: f"{randint(10,50)}x{randint(10,50)}x{randint(5,20)} سانتیمتر",
            'تاریخ انقضا': lambda: f"{randint(1401, 1405)}/{randint(1,12)}/{randint(1,28)}"
        }

        for feature in CategoryFeature.objects.filter(is_required=True):
            options = option_templates.get(feature.name, [])
            if callable(options):
                for _ in range(5):
                    FeatureOption.objects.create(
                        feature=feature,
                        value=options()
                    )
            else:
                for value in options:
                    FeatureOption.objects.get_or_create(
                        feature=feature,
                        value=value
                    )
